<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LNH Quarterly Invoice</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* PDF Background */
        body {
            background-color: #525659;
            display: flex;
            justify-content: center;
            padding: 40px 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }

        /* The "Paper" - UPDATED PADDING */
        .paper {
            background-color: white;
            width: 8.5in;
            min-height: 11in;
            /* Reduced padding to stop wrapping */
            padding: 0.25in 0.4in;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            box-sizing: border-box;
            color: #333;
            position: relative;
        }

        /* Header Styling */
        .header-section {
            margin-bottom: 25px;
        }
        
        .header-title {
            font-size: 16px; 
            font-weight: bold;
            color: #000;
            margin: 0;
        }

        .header-subtitle {
            font-size: 28px; 
            font-weight: bold;
            color: #000;
            margin-top: 5px;
            margin-bottom: 20px;
        }

        /* Grid Layouts for Info Sections */
        .info-grid {
            display: grid;
            /* Adjusted col widths slightly for new label style */
            grid-template-columns: 160px 1fr 60px 1.5fr; 
            column-gap: 15px;
            row-gap: 4px; 
            font-size: 13px;
            margin-bottom: 20px;
            align-items: center;
        }

        /* UPDATED LABEL STYLING */
        .label {
            font-weight: normal; /* Removed bold */
            color: #555; /* Changed to gray to differentiate from headings */
        }

        .value {
            color: #000;
            font-weight: normal;
        }

        /* UPDATED OTC Checkbox Section */
        .otc-section {
            grid-column: 1 / -1; 
            display: flex;
            align-items: center;
            margin-top: 8px;
            gap: 10px;
            font-size: 11px; /* Made smaller */
            color: #333;
        }
        
        /* Scale down checkboxes slightly to match small text */
        .otc-section input[type="checkbox"] {
             transform: scale(0.9);
        }

        .otc-line {
            border-bottom: 1px solid #000;
            flex-grow: 0;
            width: 250px;
            margin-left: 10px;
        }

        /* School Info Grid */
        .school-grid {
            display: grid;
            grid-template-columns: 130px 1fr 100px 1fr;
            column-gap: 15px;
            row-gap: 4px;
            font-size: 13px; 
            margin-bottom: 25px;
        }

        /* Section Headers */
        .section-header {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px; 
            margin-top: 25px;
            color: #000; /* Stands out against gray labels */
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            border: 2px solid #000; 
        }

        th {
            background-color: #000;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: bold;
        }

        td {
            border: 1px solid #000;
            padding: 10px;
            vertical-align: top;
        }

        .desc-col { width: 80%; }
        .cost-col { width: 20%; text-align: left; font-weight: bold; font-size: 13px;}

        /* Table Text Styling */
        .item-title {
            font-size: 13px;
            font-weight: bold;
            display: block;
            margin-bottom: 0px;
            line-height: 1.2;
        }

        .item-helper {
            font-size: 11px;
            color: #444;
            font-weight: normal;
            line-height: 1.2;
            display: block;
            margin-top: 2px;
        }

        /* Footer Days Count */
        .footer-days {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px; 
            margin-top: 20px;
            font-size: 13px;
        }

        .day-block { width: 100%; }

        .day-number {
            font-weight: bold;
            font-size: 14px;
            display: block;
            margin-bottom: 2px;
            margin-left: 5px;
        }

        .day-line {
            border-top: 1px solid #000;
            padding-top: 4px;
            width: 100%;
        }
        
        .day-subtext {
            font-size: 11px;
            color: #555;
            margin-top: 2px;
            line-height: 1.3;
        }

        /* Admin Notes */
        .admin-notes {
            margin-top: 30px;
            border: 1px solid #000;
            height: 40px;
            padding: 10px;
            font-size: 13px;
            position: relative;
        }

        .admin-label {
            position: absolute;
            top: 10px;
            left: 10px;
            font-weight: bold;
        }

        .footer-id {
            margin-top: 50px;
            font-size: 10px;
            text-align: right;
            color: #888;
        }

        /* Payment Approval Stamp */
        .payment-approval {
            margin-top: 8px;
            font-size: 11px;
            font-weight: bold;
            color: #D32F2F;
            border: 2px solid #D32F2F;
            padding: 2px 6px;
            display: none; /* Hidden by default */
            transform: rotate(-3deg); /* Slight tilt for stamp effect */
            position: relative;
        }

        /* Dev Callout Styles */
        .dev-marker {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 12px;
            height: 12px;
            background-color: #8B5CF6;
            border-radius: 50%;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 0 0 2px white;
            animation: pulse-purple 2s infinite;
        }
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        .dev-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) rotate(3deg); /* Counter-rotate to keep text straight */
            margin-bottom: 8px;
            background: #1F2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            width: 220px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 30;
        }
        .dev-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 4px;
            border-style: solid;
            border-color: #1F2937 transparent transparent transparent;
        }
        .dev-marker.active + .dev-tooltip {
            opacity: 1;
        }

        /* Dev History Component */
        .dev-history-trigger {
            position: fixed; bottom: 24px; right: 24px;
            width: 48px; height: 48px;
            background-color: #8B5CF6;
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            transition: transform 0.2s;
        }
        .dev-history-trigger:hover { transform: scale(1.1); }
        .dev-history-panel {
            position: fixed; bottom: 85px; right: 24px;
            width: 320px;
            background: white; border: 1px solid #E5E7EB; border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
            z-index: 9999; display: none; overflow: hidden;
        }
        .dev-history-panel.show { display: block; animation: slideUp 0.2s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .dev-history-header { background: #F9FAFB; padding: 12px 16px; font-weight: 600; font-size: 0.9rem; color: #111827; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center; }
        .dev-history-list { max-height: 400px; overflow-y: auto; padding: 0; margin: 0; list-style: none; }
        .dev-history-item { padding: 12px 16px; border-bottom: 1px solid #F3F4F6; font-size: 0.85rem; }
        .dev-history-item:last-child { border-bottom: none; }
        .dev-history-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; font-size: 0.75rem; color: #6B7280; }
        .dev-history-date { font-weight: 600; }
        .dev-history-ticket { font-family: monospace; background: #F3F4F6; padding: 2px 6px; border-radius: 4px; color: #4B5563; font-size: 0.7rem; border: 1px solid #E5E7EB; }
        .dev-history-note { color: #374151; line-height: 1.4; }
        @media print { .dev-history-trigger, .dev-history-panel { display: none !important; } }

        /* --- SPEC MODE STYLES --- */
        .spec-marker {
            position: absolute;
            background-color: #F97316;
            color: white;
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px;
            cursor: pointer; z-index: 2000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid white;
            transition: transform 0.2s;
        }
        .spec-marker:hover { transform: scale(1.1); }
        .spec-marker.purple-star { background-color: #8B5CF6; border-color: white; }
        .spec-marker.updated { background-color: #0ea5e9; box-shadow: 0 0 0 2px #0ea5e9; }
        .spec-marker.new { background-color: #15803d; box-shadow: 0 0 0 2px #15803d; }
        
        .spec-slideout {
            position: fixed; top: 0; right: -420px; width: 400px; height: 100vh;
            background: white; box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            z-index: 3000; transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; border-left: 1px solid #e5e7eb;
        }
        .spec-slideout.open { right: 0; }
        
        /* Spec Panel Internal Styles */
        .spec-panel-header { position: sticky; top: 0; background: white; z-index: 10; padding: 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
        .spec-panel-header h3 { margin: 0; font-size: 18px; font-weight: 700; color: #111827; }
        .spec-content-wrapper { padding: 24px; background-color: #f9fafb; min-height: calc(100vh - 70px); }
        .spec-item { margin-bottom: 24px; padding: 0; border-radius: 8px; border: 2px solid transparent; transition: all 0.3s; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); scroll-margin-top: 90px; overflow: hidden; cursor: pointer; }
        .spec-item.active { border-color: #F97316; box-shadow: 0 0 15px rgba(249, 115, 22, 0.3); }
        .spec-item-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e5e7eb; padding: 10px 14px; background-color: #f3f4f6; }
        .spec-item-body { padding: 20px; }
        .spec-section { margin-bottom: 24px; }
        .spec-label { display: block !important; text-transform: uppercase !important; color: #4b5563 !important; font-weight: 700 !important; letter-spacing: 0.02em !important; font-size: 11px !important; margin-bottom: 4px !important; }
        .spec-text { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important; font-size: 14px !important; color: #111827 !important; font-weight: 400 !important; line-height: 1.6 !important; }
        .spec-number { display: inline-flex; align-items: center; justify-content: center; background-color: #374151; color: white; min-width: 20px; height: 20px; padding: 0 4px; border-radius: 4px; margin-right: 8px; font-size: 11px; font-weight: 700; }
        .spec-type { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #0369a1; background: #e0f2fe; padding: 3px 8px; border-radius: 4px; letter-spacing: 0.025em; display: inline-block; margin-top: 0; }
        .code-snippet { font-family: monospace; background: #f3f4f6; padding: 3px 6px; border-radius: 4px; color: #d946ef; font-size: 12px; }
        
        /* Controls */
        .controls-container {
            position: fixed; bottom: 24px; left: 24px;
            background: white; padding: 16px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; gap: 12px;
            z-index: 9999; border: 1px solid #E5E7EB;
        }
        .control-item { display: flex; align-items: center; gap: 10px; }
        .control-label { font-size: 13px; font-weight: 600; color: #374151; }
        
        /* Switch */
        .switch { position: relative; display: inline-block; width: 32px; height: 18px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4ADE80; }
        input:checked + .slider:before { transform: translateX(14px); }
        
        @media print { .controls-container, .spec-marker, .spec-slideout { display: none !important; } }
        
        /* Body shift for spec panel */
        body { transition: padding-right 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        body.spec-panel-open { padding-right: 400px; }
    </style>
</head>
<body>

    <div class="paper">
        <div class="header-section" id="pageHeader">
            <h1 class="header-title">Lindsey Nicole Henry (LNH) Scholarship</h1>
            <h2 class="header-subtitle">Quarterly Invoice</h2>
        </div>

        <div class="info-grid" id="topSection">
            <div class="label">Invoice #</div>
            <div class="value">1115-22858</div>
            <div class="label">Attn:</div>
            <div class="value">Stacy Eden</div>

            <div class="label">Invoice Date</div>
            <div class="value">12/8/2025</div>
            <div class="label"></div>
            <div class="value">Special Education Services</div>

            <div class="label">Vendor Name</div>
            <div class="value">Blake Zimmerman</div>
            <div class="label">Office:</div>
            <div class="value">(123) 867-5309</div>

            <div class="label">Payee Number</div>
            <div class="value">12345</div>
            <div class="label">Email:</div>
            <div class="value">seden@sde.ok.gov</div>

            <div class="label">Location</div>
            <div class="value">Location 0</div>
            <div class="label"></div>
            <div class="value"></div>

            <div class="otc-section">
                <input type="checkbox"> OTC clear 
                <input type="checkbox"> OTC hold
                <div class="otc-line"></div>
            </div>
        </div>

        <div class="section-header">Private School Information:</div>
        <div class="school-grid" id="schoolSection">
            <div class="label">School Name</div>
            <div class="value">Empowered Solutions</div>
            <div class="label">Address</div>
            <div class="value">4001 N Classen Blvd. Suite 100</div>

            <div class="label">Website</div>
            <div class="value"></div>
            <div class="label">City</div>
            <div class="value">Oklahoma City</div>

            <div class="label">Contact Name</div>
            <div class="value">Amy Davis</div>
            <div class="label">State</div>
            <div class="value">OK</div>

            <div class="label">Contact Phone</div>
            <div class="value">(209) 872-4788</div>
            <div class="label">Zip Code</div>
            <div class="value">73118</div>

            <div class="label">Contact Email</div>
            <div class="value">Empoweredsolutions4001@gmail.com</div>
        </div>

        <div class="section-header">Student Information:</div>
        <div class="info-grid" style="grid-template-columns: 160px 1fr 130px 1fr;" id="studentSection">
             <div class="label">Full Name</div><div class="value">Blake Zimmerman</div>
             <div class="label">Reporting Period</div><div class="value">Quarter 1</div>
             
             <div class="label">DOB</div><div class="value">9/29/2025</div>
             <div class="label">Quarter Date From</div><div class="value">8/6/2025</div>

             <div class="label">Grade Level</div><div class="value">2nd Grade</div>
             <div class="label">Quarter Date To</div><div class="value">10/9/2025</div>

             <div class="label">Parent Guardian Name</div><div class="value">Blake Zimmerman</div>
             <div class="label">Withdrawal Date</div><div class="value">N/A</div>
        </div>

        <table id="descTable">
            <thead>
                <tr>
                    <th class="desc-col">Description</th>
                    <th class="cost-col">Cost</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <span class="item-title">Quarterly Private School Tuition and Fees:</span>
                        <span class="item-helper">To calculate this amount, take your annual tuition + fees and divide by 4.</span>
                    </td>
                    <td class="cost-col">$ 3237.50</td>
                </tr>
                <tr>
                    <td>
                        <span class="item-title">Quarterly LNH Scholarship:</span>
                        <span class="item-helper">This amount can be found on Line 10 of the LNH Calculation Worksheet.</span>
                    </td>
                    <td class="cost-col">$ 7863.53</td>
                </tr>
                <tr>
                    <td>
                        <span class="item-title">Quarterly Check Amount:</span>
                        <span class="item-helper">Check will be issued for the scholarship amount or private school tuition + fees, whichever is less.<br>Parent/Guardian will endorse check over to the private school.</span>
                    </td>
                    <td class="cost-col">
                        $ 3237.50
                        <div class="payment-approval" id="approvalStamp">
                            Pay 12/22/2025 SE
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="footer-days">
            <div class="day-block">
                <span class="day-number">23</span>
                <div class="day-line">Number of Days in Private School Quarter</div>
            </div>
            <div class="day-block">
                <span class="day-number">23</span>
                <div class="day-line">Number of Days Student Was Present</div>
                <div class="day-subtext">(Provide attendance report for each student showing every day in the quarter. Report should contain daily present or absent status.)</div>
            </div>
        </div>

        <div class="admin-notes" id="adminNotes">
            <span class="admin-label">Administrator Notes:</span>
        </div>

        <div class="footer-id">Invoice 1115-22858 - Blake Zimmerman</div>

    </div>

    <!-- Page Controls -->
    <div class="controls-container">
        <div class="control-item">
            <label class="switch"><input type="checkbox" id="specModeToggle" onchange="toggleSpecMode(this)"><span class="slider round"></span></label>
            <span class="control-label">Spec Mode</span>
        </div>
        <div class="control-item">
            <label class="switch"><input type="checkbox" id="stampToggle" onchange="toggleStamp(this)"><span class="slider round"></span></label>
            <span class="control-label">Show Stamp</span>
        </div>
    </div>

    <!-- Spec Slide-out Panel -->
    <div id="specPanel" class="spec-slideout"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const showStamp = urlParams.get('stamp') === 'true';
            const toggle = document.getElementById('stampToggle');
            
            if (showStamp) { toggle.checked = true; toggleStamp(toggle); }
            lucide.createIcons();
            
            // Init Spec Mode if saved
            const isSpec = localStorage.getItem('specMode') === 'true';
            const specToggle = document.getElementById('specModeToggle');
            if(specToggle) { specToggle.checked = isSpec; if(isSpec) toggleSpecMode(specToggle); }
        });

        function toggleStamp(checkbox) {
            const stamp = document.getElementById('approvalStamp');
            stamp.style.display = checkbox.checked ? 'inline-block' : 'none';
            if (document.body.classList.contains('spec-mode')) renderSpecMarkers();
        }
    </script>

    <script src="history.js"></script>
    <script src="specs.js"></script>
    <script>
        // --- SPEC MODE LOGIC ---
        function toggleSpecMode(checkbox) {
            const isSpec = checkbox.checked;
            if (isSpec) {
                document.body.classList.add('spec-mode');
                renderSpecMarkers();
                renderSpecPanel();
            } else {
                document.body.classList.remove('spec-mode');
                removeSpecMarkers();
                toggleSpecPanel(false);
            }
            localStorage.setItem('specMode', isSpec);
        }

        function getCurrentSpecKey() { return 'invoice_pdf'; }

        function renderSpecMarkers() {
            removeSpecMarkers();
            if (!document.body.classList.contains('spec-mode')) return;
            const specKey = getCurrentSpecKey();
            if (!window.PAGE_SPECS || !window.PAGE_SPECS[specKey]) return;
            const specs = window.PAGE_SPECS[specKey];
            const container = document.querySelector('.paper'); // Position relative to paper
            let specCount = 0;

            specs.forEach((spec, index) => {
                const target = document.getElementById(spec.targetId);
                if (target) {
                    // Skip hidden elements
                    if (window.getComputedStyle(target).display === 'none') return;

                    const rect = target.getBoundingClientRect();
                    const paperRect = container.getBoundingClientRect();
                    const marker = document.createElement('div');
                    marker.className = 'spec-marker';
                    if (spec.status === 'updated') marker.classList.add('updated');
                    if (spec.status === 'new') marker.classList.add('new');
                    if (spec.specialMarker === 'purple-star') {
                        marker.classList.add('purple-star');
                        marker.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`;
                    } else {
                        specCount++;
                        marker.innerText = specCount;
                    }
                    // Position relative to paper
                    const baseTop = rect.top - paperRect.top - 14;
                    const baseLeft = rect.right - paperRect.left - 14;

                    let topOffset = '', leftOffset = '';
                    if (spec.offset) {
                        if (spec.offset.top) topOffset += ` + ${spec.offset.top}`;
                        if (spec.offset.bottom) topOffset += ` - ${spec.offset.bottom}`;
                        if (spec.offset.left) leftOffset += ` + ${spec.offset.left}`;
                        if (spec.offset.right) leftOffset += ` - ${spec.offset.right}`;
                    }

                    marker.style.top = `calc(${baseTop}px${topOffset})`;
                    marker.style.left = `calc(${baseLeft}px${leftOffset})`;
                    marker.onclick = (e) => { e.stopPropagation(); scrollToSpec(index + 1); };
                    container.appendChild(marker);
                }
            });
        }

        function removeSpecMarkers() { document.querySelectorAll('.spec-marker').forEach(el => el.remove()); }

        function renderSpecPanel() {
            const panel = document.getElementById('specPanel');
            const specKey = getCurrentSpecKey();
            if (!window.PAGE_SPECS || !window.PAGE_SPECS[specKey]) return;
            const specs = window.PAGE_SPECS[specKey];
            let html = `<div class="spec-panel-header"><h3>Page Specifications (${specs.length})</h3><i data-lucide="x" class="spec-close-btn" onclick="toggleSpecPanel(false)"></i></div><div class="spec-content-wrapper">`;
            let specCount = 0;
            specs.forEach((data, index) => {
                const num = index + 1;
                
                // Custom History Content
                let customContent = '';
                if (data.specialMarker === 'purple-star' && window.projectHistory && window.projectHistory['invoice-pdf']) {
                    const history = window.projectHistory['invoice-pdf'];
                    customContent = `<div class="spec-section"><span class="spec-label">Revision History</span><div class="spec-text">`;
                    history.forEach(h => {
                        customContent += `<div style="margin-bottom:12px; border-bottom:1px solid #eee; padding-bottom:8px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <span style="font-weight:700; font-size:12px; color:#111827;">${h.date}</span>
                                <span style="font-family:monospace; background:#f3f4f6; padding:2px 6px; border-radius:4px; font-size:11px; color:#6B7280;">${h.ticket}</span>
                            </div>
                            <div style="font-size:13px; color:#374151; line-height:1.4;">${h.note}</div>
                        </div>`;
                    });
                    customContent += `</div></div>`;
                }

                let displayTitle = data.specialMarker ? data.title : `<span class="spec-number">${++specCount}</span>${data.title}`;
                const displayType = data.type ? `<span class="spec-type">${data.type}</span>` : '';
                const createSection = (label, text) => text ? `<div class="spec-section"><span class="spec-label">${label}</span><div class="spec-text">${text}</div></div>` : '';
                html += `<div id="spec-item-${num}" class="spec-item" onclick="scrollToSpec(${num})"><div class="spec-item-header"><h3 style="margin:0; font-size:14px; font-weight:700; color:#111827; display:flex; align-items:center;">${displayTitle}</h3>${displayType}</div><div class="spec-item-body"><div class="spec-section"><span class="spec-label">Target ID</span><span class="code-snippet">${data.targetId}</span></div>${customContent}${createSection("Description", data.description)}${createSection("Logic & Validation", data.logic)}${createSection("Default State", data.defaults)}${createSection("Interaction", data.interaction)}</div></div>`;
            });
            html += `</div>`;
            panel.innerHTML = html;
            lucide.createIcons();
        }

        function toggleSpecPanel(show) { const panel = document.getElementById('specPanel'); if (show) { panel.classList.add('open'); document.body.classList.add('spec-panel-open'); } else { panel.classList.remove('open'); document.body.classList.remove('spec-panel-open'); } setTimeout(renderSpecMarkers, 300); }
        
        function scrollToSpec(index) { 
            const panel = document.getElementById('specPanel'); 
            if (!panel.classList.contains('open')) toggleSpecPanel(true); 
            panel.querySelectorAll('.spec-item').forEach(el => el.classList.remove('active')); 
            const target = document.getElementById(`spec-item-${index}`); 
            if (target) { 
                target.classList.add('active'); 
                const headerOffset = 90;
                const targetPos = target.offsetTop - headerOffset;
                smoothScrollTo(panel, targetPos, 1000);
            } 
        }

        function smoothScrollTo(element, target, duration) {
            const start = element.scrollTop;
            const change = target - start;
            const startTime = performance.now();
            function animateScroll(currentTime) {
                const elapsed = currentTime - startTime;
                if (elapsed < duration) {
                    const t = elapsed / duration;
                    const ease = 1 - Math.pow(1 - t, 4);
                    element.scrollTop = start + (change * ease);
                    requestAnimationFrame(animateScroll);
                } else {
                    element.scrollTop = target;
                }
            }
            requestAnimationFrame(animateScroll);
        }

        window.addEventListener('resize', () => { if(document.body.classList.contains('spec-mode')) renderSpecMarkers(); });
    </script>
</body>
</html>